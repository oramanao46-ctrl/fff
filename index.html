<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Happy Birthday My Love</title>
    <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg-color: #ffe6eb;
            --primary: #ff8fa3;
            --secondary: #ffccd5;
            --text: #6d4c41;
            --envelope-color: #ff8fa3;
            --envelope-flap: #ff748c;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            font-family: 'Mali', cursive;
            background-color: var(--bg-color);
            color: var(--text);
            overflow: hidden;
            height: 100dvh; width: 100vw;
            position: relative;
            touch-action: manipulation;
            display: flex; flex-direction: column; justify-content: center;
        }

        /* Background */
        .bg-hearts { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; overflow: hidden; }
        .heart-bg { position: absolute; bottom: -50px; color: rgba(255, 255, 255, 0.6); font-size: 24px; animation: floatUp 10s linear infinite; }

        /* Sections */
        .section {
            display: none; width: 100%; height: 100%;
            flex-direction: column; justify-content: center; align-items: center;
            position: absolute; top: 0; left: 0; z-index: 10;
            transition: opacity 0.8s; padding: 20px;
        }
        .section.active { display: flex; animation: fadeIn 0.8s ease-in; }

        /* --- 1. Password Screen --- */
        .pass-hero-img {
            width: 120px;
            margin-bottom: 20px;
            filter: drop-shadow(0 5px 10px rgba(255,143,163,0.4));
            animation: floatHero 3s ease-in-out infinite;
        }
        .pass-dots { display: flex; gap: 15px; margin-bottom: 20px; }
        .dot { width: 15px; height: 15px; background: white; border-radius: 50%; transition: 0.3s; border: 2px solid var(--primary); }
        .dot.active { background: var(--primary); transform: scale(1.2); }
        
        .numpad { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 15px; 
            margin-top: 10px; 
            width: auto;
        }
        .num-btn {
            width: 65px; height: 65px;
            border-radius: 50%; border: none;
            background: rgba(255,255,255,0.95); font-size: 22px; color: var(--primary);
            box-shadow: 0 4px 10px rgba(255,143,163,0.2); cursor: pointer; transition: 0.2s;
            font-family: 'Mali', cursive; font-weight: bold;
        }
        .num-btn:active { transform: scale(0.9); background: var(--secondary); }
        #wrong-msg { height: 25px; color: #e91e63; font-weight: bold; font-size: 14px; margin-top: 10px;}

        /* --- 2. Cake Screen --- */
        .cake-wrapper { 
            position: relative; 
            width: 80%; max-width: 300px;
            display: flex; justify-content: center; align-items: flex-end; 
            cursor: pointer; margin-top: 30px;
        }
        .cake-img { width: 100%; display: block; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1)); z-index: 2; }
        
        .candles-group { position: absolute; top: -30px; display: flex; gap: 15px; z-index: 1; justify-content: center; }
        .candle { width: 12px; height: 60px; background: repeating-linear-gradient(45deg, #fff, #fff 5px, #ffcc80 5px, #ffcc80 10px); position: relative; border-radius: 4px; }
        .candle.center { height: 75px; top: -10px; background: repeating-linear-gradient(45deg, #fff, #fff 5px, #ff8fa3 5px, #ff8fa3 10px); }
        
        .flame {
            position: absolute; top: -22px; left: 50%; transform: translateX(-50%);
            width: 16px; height: 26px; background: radial-gradient(ellipse at bottom, #ffeb3b, #ff9800);
            border-radius: 50% 50% 20% 20%; animation: flicker 0.1s infinite alternate; transition: opacity 0.8s;
            box-shadow: 0 0 10px #ffeb3b;
        }
        .flame.out { opacity: 0; }
        #cheer-msg { margin-top:30px; height:30px; font-size: 18px; font-weight:bold; color:var(--primary); }

        /* --- 3. Balloon Screen --- */
        .balloon {
            width: 90px; height: 110px; background: #ff8fa3; border-radius: 50%;
            position: absolute; cursor: pointer; display: flex; justify-content: center; align-items: center;
            animation: float 3s ease-in-out infinite; box-shadow: inset -10px -10px 20px rgba(0,0,0,0.1), 5px 10px 15px rgba(0,0,0,0.1);
            font-weight: bold; color: white; text-shadow: 1px 1px rgba(0,0,0,0.2); font-size: 14px;
        }
        .balloon::before { content:''; position:absolute; top:20px; left:20px; width:15px; height:25px; background:rgba(255,255,255,0.5); border-radius:50%; transform:rotate(45deg); }
        .balloon::after { content:''; position: absolute; bottom: -50px; width: 2px; height: 50px; background: rgba(0,0,0,0.3); }
        .balloon.popped { transform: scale(1.5); opacity: 0; pointer-events: none; transition: 0.3s; }
        .pop-text { position: absolute; background: white; padding: 10px 20px; border-radius: 30px; opacity: 0; transform: translateY(30px); transition: 0.5s; pointer-events: none; font-weight: bold; color: var(--text); box-shadow: 0 5px 20px rgba(0,0,0,0.15); white-space: nowrap; z-index: 20; font-size: 14px; }
        .balloon.popped + .pop-text { opacity: 1; transform: translateY(-50px) scale(1.1); }

        /* --- 4. Gallery Screen --- */
        .rope { width: 100%; height: 3px; background: #795548; margin: 20px 0; position: relative; transform: rotate(-2deg); }
        .photo-clip { 
            position: absolute; top: 10px; padding: 8px; background: white; 
            box-shadow: 0 5px 10px rgba(0,0,0,0.15); transition: 0.3s; 
            width: 120px; border-radius: 5px;
        }
        .photo-clip:hover { transform: scale(1.2) rotate(0deg) !important; z-index: 50; }
        .photo-clip img { width: 100%; border-radius: 3px; display: block; }
        .btn-next { margin-top:250px; padding:12px 35px; border-radius:30px; background:var(--primary); color:white; border:none; font-size:18px; cursor:pointer; box-shadow:0 5px 15px rgba(255,143,163,0.5); font-family: 'Mali'; }

        /* --- 5. Letter Screen --- */
        .envelope-container {
            position: relative; width: 300px; height: 200px; margin-top: 50px; cursor: pointer;
        }
        .envelope-front {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 100%;
            background: var(--envelope-color); border-radius: 0 0 10px 10px; z-index: 10;
        }
        .envelope-front::before {
            content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 0;
            border-left: 150px solid transparent; border-right: 150px solid transparent;
            border-bottom: 110px solid rgb(255, 135, 159); border-radius: 0 0 10px 10px;
        }
        .envelope-flap {
            position: absolute; top: 0; left: 0; width: 0; height: 0;
            border-left: 150px solid transparent; border-right: 150px solid transparent;
            border-top: 100px solid var(--envelope-flap);
            transform-origin: top; transition: transform 0.6s ease-in-out, z-index 0.6s; z-index: 20;
        }
        .letter-paper {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            width: 270px; height: 350px;
            background: #fff url('https://www.transparenttextures.com/patterns/cream-paper.png');
            padding: 25px; box-sizing: border-box; border-radius: 5px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            transition: transform 0.8s ease-in-out 0.5s;
            z-index: 5; font-size: 16px; line-height: 1.8; color: #555;
        }
        /* Open States */
        .envelope-container.open .envelope-flap { transform: rotateX(180deg); z-index: 1; }
        .envelope-container.open .letter-paper { transform: translateX(-50%) translateY(-150px); z-index: 30; }

        @keyframes floatUp { 0%{transform: translateY(100vh) rotate(0deg); opacity:1;} 100%{transform: translateY(-100px) rotate(360deg); opacity:0;} }
        @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
        @keyframes flicker { 0%{transform: translateX(-50%) scale(1);} 100%{transform: translateX(-50%) scale(1.1);} }
        @keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-15px);} }
        @keyframes floatHero { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-8px);} }
    </style>
</head>
<body>

    <audio id="bgm" loop>
        <source src="song.mp3" type="audio/mpeg">
    </audio>

    <div class="bg-hearts" id="bg-hearts"></div>

    <div id="scene-pass" class="section active">
        <h2 style="font-size: 24px; margin-bottom: 10px;">üîí ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞</h2>
        <img src="https://cdn-icons-png.flaticon.com/512/2682/2682340.png" class="pass-hero-img" alt="cake icon">
        
        <div class="pass-dots">
            <div class="dot" id="d1"></div><div class="dot" id="d2"></div>
            <div class="dot" id="d3"></div><div class="dot" id="d4"></div>
        </div>
        <div class="numpad">
            <button class="num-btn" onclick="typePass(1)">1</button><button class="num-btn" onclick="typePass(2)">2</button><button class="num-btn" onclick="typePass(3)">3</button>
            <button class="num-btn" onclick="typePass(4)">4</button><button class="num-btn" onclick="typePass(5)">5</button><button class="num-btn" onclick="typePass(6)">6</button>
            <button class="num-btn" onclick="typePass(7)">7</button><button class="num-btn" onclick="typePass(8)">8</button><button class="num-btn" onclick="typePass(9)">9</button>
            <button class="num-btn" onclick="clearPass()" style="color:#e91e63;">C</button>
            <button class="num-btn" onclick="typePass(0)">0</button>
            <button class="num-btn" onclick="checkPass()" style="background:var(--primary); color:white;">‚ûú</button>
        </div>
        <div id="wrong-msg"></div>
    </div>

    <div id="scene-cake" class="section">
        <h1 style="font-size: 32px; margin-bottom: 10px;">Make a Wish! üéÇ</h1>
        <p style="color:#888; font-size:14px;">(‡πÄ‡∏õ‡πà‡∏≤‡πÑ‡∏°‡∏Ñ‡πå‡πÅ‡∏£‡∏á‡πÜ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏à‡∏¥‡πâ‡∏°‡πÄ‡∏Ñ‡πâ‡∏Å)</p>
        
        <div class="cake-wrapper" onclick="manualBlow()">
            <div class="candles-group">
                <div class="candle"><div class="flame" id="f1"></div></div>
                <div class="candle"><div class="flame" id="f2"></div></div>
                <div class="candle center"><div class="flame" id="f3"></div></div>
                <div class="candle"><div class="flame" id="f4"></div></div>
                <div class="candle"><div class="flame" id="f5"></div></div>
            </div>
            <img src="photo4.jpg" class="cake-img" alt="My Cake" style="border-radius: 10px;">
        </div>
        
        <div id="cheer-msg"></div>
        <button onclick="initMic()" style="margin-top:20px; background:white; border:2px solid var(--primary); color:var(--primary); padding:10px 20px; border-radius:25px; font-weight:bold; cursor:pointer;">üéôÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡∏Ñ‡πå</button>
    </div>

    <div id="scene-balloons" class="section">
        <h2 style="font-size: 28px; margin-bottom:30px; z-index:100;">‡∏à‡∏¥‡πâ‡∏°‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡∏Å‡πÄ‡∏•‡∏¢! üéà</h2>
        <div style="position:relative; width:100%; height:100%;">
            <div style="position:absolute; top:15%; left:10%;">
                <div class="balloon" style="background:#80deea;" onclick="pop(this)">‡∏à‡∏¥‡πâ‡∏°‡∏™‡∏¥</div>
                <div class="pop-text">‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏°‡∏≤‡∏Å‡πÜ ‡∏ô‡∏∞‡∏Ñ‡∏∞</div>
            </div>
            <div style="position:absolute; top:40%; right:15%;">
                <div class="balloon" style="background:#ffccbc;" onclick="pop(this)">‡∏ó‡∏≤‡∏á‡∏ô‡∏µ‡πâ</div>
                <div class="pop-text">‡∏¢‡∏¥‡πâ‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ ‡∏ô‡∏∞‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á</div>
            </div>
            <div style="position:absolute; top:60%; left:20%;">
                <div class="balloon" style="background:#b39ddb;" onclick="pop(this)">POP!</div>
                <div class="pop-text">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏ô‡∏∞</div>
            </div>
            <div style="position:absolute; top:25%; left:50%; transform:translateX(-50%);">
                <div class="balloon" style="background:#a5d6a7;" onclick="pop(this)">‡πÅ‡∏ï‡∏Å‡∏ã‡∏∞</div>
                <div class="pop-text">‡∏£‡∏±‡∏Å‡πÄ‡∏ò‡∏≠‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏•‡∏¢ ‚ù§Ô∏è</div>
            </div>
        </div>
    </div>

    <div id="scene-gallery" class="section">
        <h2 style="font-size: 28px; margin-bottom: 20px;">Memories üì∏</h2>
        <div class="rope">
            <div class="photo-clip" style="left:5%; transform:rotate(-4deg);">
                <img src="photo1.jpg" alt="Photo1">
            </div>
            <div class="photo-clip" style="left:50%; transform:translate(-50%) rotate(3deg); z-index:2;">
                <img src="photo2.jpg" alt="Photo2">
            </div>
            <div class="photo-clip" style="right:5%; transform:rotate(-3deg);">
                <img src="photo3.jpg" alt="Photo3">
            </div>
        </div>
        <button class="btn-next" onclick="nextScene('scene-gallery', 'scene-letter')">‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢ üíå</button>
    </div>

    <div id="scene-letter" class="section">
        <h2 style="margin-bottom:30px; font-size: 26px;">To My Lovely Girl...</h2>
        <div class="envelope-container" onclick="openLetter(this)">
            <div class="envelope-flap"></div>
            <div class="envelope-front"></div>
            <div class="letter-paper">
                <p>
                    <b style="font-size: 20px; color: var(--primary);">Happy Birthday! üéâ</b><br><br>
                    ‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏ô‡∏∞‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏µ‡∏ô‡∏µ‡πâ‡πÉ‡∏à‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡πÄ‡∏ò‡∏≠‡∏°‡∏≤‡∏Å‡πÜ ‡∏ô‡∏∞ 
                    ‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏ò‡∏≠‡∏¢‡∏¥‡πâ‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÜ ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏•‡∏¢
                    <br><br>
                    ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏î‡πÉ‡∏™‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ô‡∏ô‡∏∞
                    ‡∏£‡∏±‡∏Å‡πÄ‡∏™‡∏°‡∏≠‡∏ô‡∏∞‡∏Ñ‡πâ‡∏≤‡∏ö ‚ù§Ô∏è
                    <br><br>
                    <b>(‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)</b>
                </p>
            </div>
        </div>
        <p style="margin-top: 20px; color: #888; font-size: 14px;">(‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡∏ã‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î)</p>
    </div>

    <script>
        // Background Hearts
        function createHeart() {
            const heart = document.createElement('div');
            heart.classList.add('heart-bg');
            heart.innerHTML = ['‚ù§Ô∏è','üíñ','‚ú®','üéÇ'][Math.floor(Math.random()*4)];
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.animationDuration = Math.random() * 5 + 5 + 's';
            heart.style.opacity = Math.random() * 0.3 + 0.2;
            heart.style.fontSize = Math.random() * 20 + 15 + 'px';
            document.getElementById('bg-hearts').appendChild(heart);
            setTimeout(() => heart.remove(), 10000);
        }
        setInterval(createHeart, 500);

        // Logic
        const PASS = "1234"; 
        let input = "";
        
        function typePass(n) { if(input.length < 4) { input += n; updateDots(); } }
        function clearPass() { input = ""; updateDots(); document.getElementById('wrong-msg').innerText = ""; }
        function updateDots() { for(let i=1; i<=4; i++) document.getElementById('d'+i).className = "dot " + (i<=input.length ? "active" : ""); }
        function checkPass() {
            if(input === PASS) {
                document.getElementById('bgm').play().catch(() => console.log("Music blocked")); 
                nextScene('scene-pass', 'scene-cake');
            } else {
                document.getElementById('wrong-msg').innerText = "‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î‡∏á‡πà‡∏∞ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞!";
                setTimeout(clearPass, 1000);
            }
        }

        // Cake Logic
        let mic, analyser, blown = 0;
        const flames = ['f1','f2','f3','f4','f5'];
        
        async function initMic() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({audio:true});
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                analyser = ctx.createAnalyser();
                mic = ctx.createMediaStreamSource(stream);
                mic.connect(analyser);
                loopMic();
                document.querySelector('button[onclick="initMic()"]').style.display = 'none';
                document.getElementById('cheer-msg').innerText = "‡πÄ‡∏õ‡πà‡∏≤‡πÄ‡∏•‡∏¢! ‡∏ü‡∏π‡πà‡∏ß‡∏ß‡∏ß~";
            } catch(e) { alert("‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÑ‡∏°‡∏Ñ‡πå ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏à‡∏¥‡πâ‡∏°‡πÄ‡∏Ñ‡πâ‡∏Å‡πÅ‡∏ó‡∏ô‡∏ô‡∏∞!"); }
        }
        
        function loopMic() {
            const data = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(data);
            let vol = data.reduce((a,b)=>a+b) / data.length;
            if(vol > 10) doBlow(vol > 40); 
            if(blown < 5) requestAnimationFrame(loopMic);
        }

        function doBlow(isStrong) {
            let active = flames.filter(id => !document.getElementById(id).classList.contains('out'));
            if(active.length === 0) return;
            
            document.getElementById('cheer-msg').innerText = ["‡∏Æ‡∏∂‡∏ö‡πÜ!", "‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß!", "‡∏ü‡∏π‡πà‡∏ß‡∏ß‡∏ß‡∏ß!"][Math.floor(Math.random()*3)];
            let chance = isStrong ? 0.3 : 0.05;
            if(Math.random() < chance) {
                let target = active[Math.floor(Math.random()*active.length)];
                document.getElementById(target).classList.add('out');
                blown++;
                if(blown === 5) finishCake();
            }
        }
        
        function manualBlow() { doBlow(true); doBlow(true); }

        function finishCake() {
            document.getElementById('cheer-msg').innerText = "‡πÄ‡∏¢‡πâ!! ‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î! üéâ";
            confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });
            setTimeout(() => nextScene('scene-cake', 'scene-balloons'), 3500);
        }

        // Balloons
        let popped = 0;
        function pop(el) {
            if(!el.classList.contains('popped')) {
                el.classList.add('popped');
                popped++;
                confetti({ particleCount: 30, spread: 50, origin: { x: el.getBoundingClientRect().left/window.innerWidth, y: el.getBoundingClientRect().top/window.innerHeight } });
                if(popped === 4) setTimeout(() => nextScene('scene-balloons', 'scene-gallery'), 2000);
            }
        }

        // Navigation
        function openLetter(el) { el.classList.add('open'); }
        function nextScene(from, to) {
            document.getElementById(from).classList.remove('active');
            document.getElementById(to).classList.add('active');
        }
    </script>
</body>
</html>
